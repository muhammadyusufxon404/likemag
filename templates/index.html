<!-- 

 <!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Magistr To‚Äòlov CRM</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
</head>
<body>
  <div class="container">
    <h1>Magistr To‚Äòlov CRM</h1>

    <form method="POST" action="{{ url_for('index') }}">
      <label for="ismi">O‚Äòquvchi ismi va familiyasi</label>
      <input type="text" id="ismi" name="ismi" required />

      <label for="tolov">To‚Äòlov summasi (UZS)</label>
      <input type="number" id="tolov" name="tolov" min="0" required />

      <label for="kurs">Kurs nomi</label>
      <input type="text" id="kurs" name="kurs" required />

      <label for="oy">To‚Äòlov oyi</label>
      <select id="oy" name="oy" required>
        <option value="" disabled selected>Oyni tanlang</option>
        <option>Yanvar</option>
        <option>Fevral</option>
        <option>Mart</option>
        <option>Aprel</option>
        <option>May</option>
        <option>Iyun</option>
        <option>Iyul</option>
        <option>Avgust</option>
        <option>Sentabr</option>
        <option>Oktabr</option>
        <option>Noyabr</option>
        <option>Dekabr</option>
      </select>

      <label for="tolov_turi">To‚Äòlov turi</label>
      <select id="tolov_turi" name="tolov_turi" required>
        <option value="" disabled selected>To‚Äòlov turini tanlang</option>
        <option>Naqd</option>
        <option>Click</option>
      </select>

      <label for="izoh">Izoh <span class="optional">(ixtiyoriy)</span></label>
      <textarea id="izoh" name="izoh"></textarea>

      <label for="admin">Admin (to‚Äòlovni qabul qilgan)</label>
      <input type="text" id="admin" name="admin" required />

      <label for="oqituvchi">O‚Äòqituvchi (tayinlangan)</label>
      <input type="text" id="oqituvchi" name="oqituvchi" required />

      <button type="submit">To‚Äòlovni qo‚Äòshish</button>
    </form>

    <h2>Bugungi to‚Äòlovlar ({{ tolovlar|length }})</h2>
    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>O‚Äòquvchi</th>
          <th>Summa</th>
          <th>Kurs</th>
          <th>Oyi</th>
          <th>To‚Äòlov turi</th>
          <th>Izoh</th>
          <th>Admin</th>
          <th>O‚Äòqituvchi</th>
          <th>Sana & Soat</th>
        </tr>
      </thead>
      <tbody>
        {% for p in tolovlar %}
        <tr>
          <td>{{ loop.index }}</td>
          <td>{{ p[0] }}</td>
          <td>{{ p[1] }} so‚Äòm</td>
          <td>{{ p[2] }}</td>
          <td>{{ p[3] }}</td>
          <td>{{ p[8] or '-' }}</td>
          <td>{{ p[4] or '-' }}</td>
          <td>{{ p[5] }}</td>
          <td>{{ p[6] }}</td>
          <td>{{ p[7] }}</td>
        </tr>
        {% else %}
        <tr>
          <td colspan="10" class="no-data">Hozircha to‚Äòlovlar yo‚Äòq</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</body>
</html>

 -->

<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Magistr To‚Äòlov CRM</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
  <style>
    /* Chek chiqarish tugmasi */
    .print-btn {
      cursor: pointer;
      background: #004080;
      border: none;
      color: white;
      padding: 5px 10px;
      border-radius: 5px;
      font-weight: bold;
      transition: background-color 0.3s ease;
    }
    .print-btn:hover {
      background-color: #00264d;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Magistr To‚Äòlov CRM</h1>

    <form method="POST" action="{{ url_for('index') }}">
      <!-- Form elementlar (o'zgartirmadim) -->
      <label for="ismi">O‚Äòquvchi ismi va familiyasi</label>
      <input type="text" id="ismi" name="ismi" required />

      <label for="tolov">To‚Äòlov summasi (UZS)</label>
      <input type="number" id="tolov" name="tolov" min="0" required />

      <label for="kurs">Kurs nomi</label>
      <input type="text" id="kurs" name="kurs" required />

      <label for="oy">To‚Äòlov oyi</label>
      <select id="oy" name="oy" required>
        <option value="" disabled selected>Oyni tanlang</option>
        <option>Yanvar</option>
        <option>Fevral</option>
        <option>Mart</option>
        <option>Aprel</option>
        <option>May</option>
        <option>Iyun</option>
        <option>Iyul</option>
        <option>Avgust</option>
        <option>Sentabr</option>
        <option>Oktabr</option>
        <option>Noyabr</option>
        <option>Dekabr</option>
      </select>

      <label for="tolov_turi">To‚Äòlov turi</label>
      <select id="tolov_turi" name="tolov_turi" required>
        <option value="" disabled selected>To‚Äòlov turini tanlang</option>
        <option>Naqd</option>
        <option>Click</option>
      </select>

      <label for="izoh">Izoh <span class="optional">(ixtiyoriy)</span></label>
      <textarea id="izoh" name="izoh"></textarea>

      <label for="admin">Admin (to‚Äòlovni qabul qilgan)</label>
      <input type="text" id="admin" name="admin" required />

      <label for="oqituvchi">O‚Äòqituvchi (tayinlangan)</label>
      <input type="text" id="oqituvchi" name="oqituvchi" required />

      <button type="submit">To‚Äòlovni qo‚Äòshish</button>
    </form>

    <h2>Bugungi to‚Äòlovlar ({{ tolovlar|length }})</h2>
    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>O‚Äòquvchi</th>
          <th>Summa</th>
          <th>Kurs</th>
          <th>Oyi</th>
          <th>To‚Äòlov turi</th>
          <th>Izoh</th>
          <th>Admin</th>
          <th>O‚Äòqituvchi</th>
          <th>Sana & Soat</th>
          <th>Chek</th> <!-- Yangi ustun -->
        </tr>
      </thead>
      <tbody>
        {% for p in tolovlar %}
        <tr>
          <td>{{ loop.index }}</td>
          <td>{{ p[0] }}</td>
          <td>{{ p[1] }} so‚Äòm</td>
          <td>{{ p[2] }}</td>
          <td>{{ p[3] }}</td>
          <td>{{ p[8] or '-' }}</td>
          <td>{{ p[4] or '-' }}</td>
          <td>{{ p[5] }}</td>
          <td>{{ p[6] }}</td>
          <td>{{ p[7] }}</td>
          <td>
            <button class="print-btn"
              onclick="openReceiptPopup(
                {{ loop.index }},
                '{{ p[0]|e('js') }}',
                '{{ p[1] }}',
                '{{ p[2]|e('js') }}',
                '{{ p[3]|e('js') }}',
                '{{ p[8]|e('js') or 'Noma ºlum' }}',
                '{{ p[4]|e('js') or '-' }}',
                '{{ p[5]|e('js') }}',
                '{{ p[6]|e('js') }}',
                '{{ p[7]|e('js') }}'
              )"
              title="Chek chiqarish"
            >
              üñ®Ô∏è
            </button>
          </td>
        </tr>
        {% else %}
        <tr>
          <td colspan="11" class="no-data">Hozircha to‚Äòlovlar yo‚Äòq</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

<script>
function openReceiptPopup(
  index, ism, summa, kurs, oy, tolov_turi, izoh, admin, oqituvchi, sana_soat
) {
  const receiptContent = `
    <html>
    <head>
      <title>Chek - ${ism}</title>
      <style>
        body {
          font-family: Arial, sans-serif;
          padding: 20px;
          color: #333;
          background: #f7f9fc;
        }
        h2 {
          color: #004080;
          text-align: center;
          margin-bottom: 20px;
        }
        p {
          font-size: 16px;
          margin: 6px 0;
        }
        hr {
          margin: 20px 0;
          border: none;
          border-top: 1px solid #ccc;
        }
        .footer {
          margin-top: 30px;
          text-align: center;
          font-weight: bold;
          color: #004080;
        }
        button {
          display: block;
          margin: 25px auto 0;
          padding: 10px 25px;
          background-color: #004080;
          border: none;
          border-radius: 6px;
          color: white;
          font-size: 16px;
          cursor: pointer;
          transition: background-color 0.3s ease;
        }
        button:hover {
          background-color: #00264d;
        }
      </style>
    </head>
    <body>
      <h2>Magistr O'quv Markazi</h2>
      <p><strong>ID:</strong> ${index}</p>
      <p><strong>O‚Äòquvchi:</strong> ${ism}</p>
      <p><strong>Summa:</strong> ${summa} so‚Äòm</p>
      <p><strong>Kurs:</strong> ${kurs}</p>
      <p><strong>Oyi:</strong> ${oy}</p>
      <p><strong>To‚Äòlov turi:</strong> ${tolov_turi}</p>
      <p><strong>Izoh:</strong> ${izoh}</p>
      <p><strong>Admin:</strong> ${admin}</p>
      <p><strong>O‚Äòqituvchi:</strong> ${oqituvchi}</p>
      <p><strong>Sana & Soat:</strong> ${sana_soat}</p>
      <hr />
      <div class="footer">Rahmat!</div>
      <button onclick="window.print()">Chop etish</button>
    </body>
    </html>
  `;

  const popup = window.open('', 'Chek', 'width=400,height=600');
  popup.document.write(receiptContent);
  popup.document.close();
  popup.focus();
}
</script>

</body>
</html>
